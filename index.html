<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bomb Game</title>

<style>
    body {
        margin: 0;
        padding: 0;
        background: #111;
        color: #fff;
        font-family: sans-serif;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        overflow: hidden;
    }

    #startBtn {
        background: linear-gradient(135deg, #ff3b3b, #b30000);
        color: #fff;
        padding: 15px 35px;
        font-size: 28px;
        border: none;
        border-radius: 15px;
        cursor: pointer;
        box-shadow: 0 0 20px rgba(255, 0, 0, 0.6);
        transition: 0.2s;
    }
    #startBtn:hover {
        transform: scale(1.05);
        box-shadow: 0 0 30px rgba(255, 60, 60, 0.9);
    }

    #logoBomb {
        width: 200px;
        margin: 20px 0;
        display: none;
        transition: 0.2s;
    }

    #timer {
        font-size: 50px;
        margin: 10px 0;
    }

    #questionBox {
        font-size: 30px;
        margin: 15px 0;
    }

    #answerInput {
        font-size: 26px;
        padding: 10px;
        width: 130px;
        text-align: center;
        border-radius: 10px;
        border: none;
        outline: none;
        display: none;
    }

    #submitAnswer {
        margin-top: 10px;
        padding: 14px 28px;
        background: #00c853;
        color: #fff;
        font-size: 22px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        display: none;
    }

    #submitAnswer:hover {
        background: #00e676;
    }

    #flash {
        position: fixed;
        top:0;
        left:0;
        width:100%;
        height:100%;
        background:white;
        opacity:0;
        pointer-events:none;
        z-index:1000;
    }

    .shockwave {
        position: fixed;
        top:50%;
        left:50%;
        width:20px;
        height:20px;
        background:white;
        border-radius:50%;
        transform: translate(-50%, -50%) scale(0);
        opacity:0.8;
        pointer-events:none;
        animation: shockwaveAnim 0.6s forwards ease-out;
    }

    @keyframes shockwaveAnim {
        0%   { transform: translate(-50%, -50%) scale(0); opacity:1; }
        100% { transform: translate(-50%, -50%) scale(25); opacity:0; }
    }

    @keyframes shake {
        0% { transform: translate(0,0); }
        20% { transform: translate(-10px, 8px); }
        40% { transform: translate(8px, -10px); }
        60% { transform: translate(-8px, -5px); }
        80% { transform: translate(7px, 10px); }
        100% { transform: translate(0,0); }
    }

    #restartBtn {
        display:none;
        margin-top:25px;
        padding:14px 32px;
        font-size:24px;
        border:none;
        border-radius:12px;
        background:#2979ff;
        color:#fff;
        cursor:pointer;
        box-shadow:0 0 12px rgba(0,140,255,0.6);
    }
</style>
</head>
<body>

<div id="flash"></div>

<button id="startBtn">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>

<img id="logoBomb" src="logo.png" />

<div id="timer"></div>
<div id="questionBox"></div>

<input id="answerInput" type="number" />
<button id="submitAnswer">Ø«Ø¨Øª</button>

<button id="restartBtn">Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ¨Ø§Ø±Ù‡</button>


<script>
let timeLeft = 60;
let ticking;
let dingInterval;
let num1, num2;
let audioCtx;

function soundDing() {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();

    osc.frequency.value = 900;
    gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);

    osc.connect(gain);
    gain.connect(audioCtx.destination);

    osc.start();
    osc.stop(audioCtx.currentTime + 0.1);
}

function soundExplosion() {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    const bufferSize = audioCtx.sampleRate * 0.4;
    const noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
    const output = noiseBuffer.getChannelData(0);
    for (let i = 0; i < bufferSize; i++) output[i] = Math.random() * 2 - 1;

    const noise = audioCtx.createBufferSource();
    noise.buffer = noiseBuffer;

    const gain = audioCtx.createGain();
    gain.gain.setValueAtTime(1, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);

    noise.connect(gain);
    gain.connect(audioCtx.destination);

    noise.start();
}

function newQuestion() {
    num1 = Math.floor(Math.random() * 90) + 10;
    num2 = Math.floor(Math.random() * 90) + 10;
    questionBox.textContent = `${num1} + ${num2} = ?`;
    answerInput.value = "";
}

function startDingLoop() {
    clearInterval(dingInterval);
    dingInterval = setInterval(() => soundDing(), Math.max(200, timeLeft * 9));
}

function startGame() {
    startBtn.style.display = "none";
    logoBomb.style.display = "block";
    answerInput.style.display = "block";
    submitAnswer.style.display = "block";

    newQuestion();
    startDingLoop();

    ticking = setInterval(() => {
        timeLeft--;
        timer.textContent = timeLeft + " Ø«Ø§Ù†ÛŒÙ‡";

        if (timeLeft <= 0) explodeBomb();

    }, 1000);
}

function explodeBomb() {
    clearInterval(ticking);
    clearInterval(dingInterval);

    flash.style.transition = "0.15s";
    flash.style.opacity = 1;
    setTimeout(() => flash.style.opacity = 0, 150);

    soundExplosion();

    const wave = document.createElement("div");
    wave.className = "shockwave";
    document.body.appendChild(wave);
    setTimeout(() => wave.remove(), 700);

    document.body.style.animation = "shake 0.5s";

    logoBomb.style.opacity = 0;
    timer.textContent = "ðŸ’¥ ";

    restartBtn.style.display = "inline-block";
}

submitAnswer.addEventListener("click", () => {
    const val = parseInt(answerInput.value);
    if (val === num1 + num2) {
        newQuestion();
    }
});

startBtn.addEventListener("click", startGame);

restartBtn.addEventListener("click", () => location.reload());
</script>

</body>
</html>
